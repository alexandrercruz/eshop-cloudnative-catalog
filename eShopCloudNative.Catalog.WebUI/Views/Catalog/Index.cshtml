@using eShopCloudNative.Catalog.Dto
@using eShopCloudNative.Catalog.Services

<cache expires-after="@WebConstants.Instance.HomeCatalogCacheTimeout" enabled="@WebConstants.Instance.HomeCatalogCacheTimeout != TimeSpan.Zero">
    @{
        IPublicCatalogService publicCatalogService = this.ViewBag.publicCatalogService;

        if (publicCatalogService == null)
        {
            throw new InvalidOperationException("ViewBag.publicCatalogService is not set. _Menu.cshtml require a valid instance of IPublicCatalogService on ViewBag.publicCatalogService");
        }

        IEnumerable<CategoryDto> categorias = null;
        try
        {
            categorias = await publicCatalogService.GetHomeCatalogAsync();
        }
        catch (Exception)
        {
            categorias = Array.Empty<CategoryDto>();
        }

        ViewData["Title"] = "Home Page";
    }

    @foreach (var category in categorias)
    {
        <partial name="../Shared/Shared.Category.cshtml" model="@(category)" />
    }
</cache>
